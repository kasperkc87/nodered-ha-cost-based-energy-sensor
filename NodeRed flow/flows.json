[{"id":"aef585968474e6bc","type":"function","z":"bc8e70e562a75756","name":"Find chargng window","func":"//Settings\nvar startHour = 20; //0= 00:00:00, 12=12:00:00, 24=00:00:00 (day 2), \nvar endHour = 31;\nvar chargingTime = 4;\nvar PowerNeedIn = 7.36; //kWh\n\n//Internal var\nvar sum = 0;\nvar i = 0;\nvar chargingTimeEnd = 0;\nvar array;\nvar sumArray;\n\n//Output\nvar outputValue = 0;\nvar outputStartHour = 0;\nvar outputHours = 0;\n\n//Load payload\narray = msg.payload\n\n//Debug line 1\nmsg.array = array;\n\n//Debug line 2\nvar indexArray = array; //[];\nindexArray = indexArray.slice(startHour, endHour);\n\nmsg.indexArray = indexArray;\n\nchargingTimeEnd = indexArray.length - chargingTime;\n\nfor ( i = 0; i <= chargingTimeEnd; i++) {\n    var chargingIndex = chargingTime + i;\n    sumArray = indexArray.slice(i, chargingIndex);\n\n    sum = sumArray.reduce(function (a, b) {\n        return a + b;\n    }, 0);\n\n    if (outputValue > sum || outputValue == 0) {\n        outputValue = sum;\n        //Debug line 3 - Start hour \n        msg.i = i;\n        //Debug line 4 - Price in period \n        msg.price = indexArray.slice(i);\n\n        if ((i + startHour) < 23) {\n            outputStartHour = startHour + i;\n        }\n        else {\n            outputStartHour = i - (24 - startHour);\n        }\n\n    }\n    outputHours = sumArray;\n}\n\nif (outputStartHour > 10) {\n    var outputStartHourTimeFormat = +outputStartHour + ':00'\n} else {\n    outputStartHourTimeFormat = '0' + outputStartHour + ':00'\n}\n\noutputValue = parseFloat(outputValue).toFixed( 2 );\n\nvar avaragePricePrKWH = parseFloat((outputValue/chargingTime)).toFixed( 2 );\n\nvar EstimatedPriceInChargingPeriode = parseFloat(((outputValue/chargingTime)*PowerNeedIn)).toFixed( 2 );\n\nmsg.payload = \n\n    \n    '{\"totalSum\":' +outputValue+','\n    \n    +'\"avaragePricePrKWH\":' +avaragePricePrKWH+','\n    \n    +'\"EstimatedPriceInChargingPeriode\":' +EstimatedPriceInChargingPeriode+','\n    \n    +'\"outputStartHour\":\"' +outputStartHourTimeFormat+'\",'\n    \n    +'\"chargingTime\":' +chargingTime+'}'\n    \n   \nreturn msg;\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":160,"wires":[["88ca9c97285b59b9","8604241a25be5a98","a49e2178538ae139","4bd4d2bba9e7a79b","d5a912f5e8e61a28","9437d88b37ded093","192b9c67299b6bf4"]]}]